---
title: "Practice"
author: "kknickels"
date: "Thursday, May 14, 2015"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

This is the first assignment for Reproducible Research.  The data used of for this work is found at the URL below: 

data source:  https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip

##Getting started:

As a first step, the packages are pulled in (data.table and dplyr), the directory is defined.
```{r}
  
  library(data.table)
  library(dplyr)
  setwd("~/RCode/RepRes")
  url1 <-"activity.csv"
```


##Loading and preprocessing the data:

The data was imported into a dataframe from CSV.  The character date converted to POSIXct for easier manipulation.
The date is converted to day names and added to a new variable "wkdy".  This variable is then updated to factor weekends "WE" or weekdays/workweek "WW".  I used character substitution, if you see this it means I had not got a more elegant way to work before the deadline!

The next step was to split the table into observations with and without "NA" for step values.


```{r}
  
  mydata1 <- read.csv(url1,header=TRUE, skip=0, na.strings="NA", stringsAsFactors=FALSE,nrows=-1L)

  mydata2 <- tbl_df(mydata1)
  mydata2$date <- as.POSIXct(mydata2$date, format = "%Y-%m-%d", tz="")
  mydata2$wkdy <- weekdays(mydata2$date, abbreviate = TRUE)
  mydata2$wkdy <- sub("Sun", "Weekend",mydata2$wkdy)
  mydata2$wkdy <- sub("Sat", "Weekend",mydata2$wkdy)
  mydata2$wkdy <- sub("Mon", "Weekday",mydata2$wkdy) 
  mydata2$wkdy <- sub("Tue", "Weekday",mydata2$wkdy)
  mydata2$wkdy <- sub("Wed", "Weekday",mydata2$wkdy)
  mydata2$wkdy <- sub("Thu", "Weekday",mydata2$wkdy)
  mydata2$wkdy <- sub("Fri", "Weekday",mydata2$wkdy)

  x <- subset(mydata2,is.na(mydata2$steps))

  mydata3 <- subset(mydata2,!is.na(mydata2$steps))


```
##What is mean total number of steps taken per day?:

Group the steps by date and calcualte the means and medians by date and total. 
Note: In the first set of results are shown for only the populated observations.

```{r , echo = TRUE}

DFGroupDate <- group_by(mydata3, date)
DFResultDate <- summarise(DFGroupDate,Mean = mean(steps), SUM = as.numeric(sum(steps)))

  stepMedian <-median(DFResultDate$SUM) 
  stepMean <-mean(DFResultDate$SUM) 
 
```

Histogram by interval and by date, with the calculated means and medians

```{r, echo=FALSE}
 hist(DFResultDate$SUM, xlab = "Number of Steps per Day", ylab = "Frequency", col = "red", main = "Histogram of Daily Step Total")

  cat("The mean daily average = ", round(stepMean))
  cat("The median daily average = ", round(stepMedian))
```

##What is the average daily activity pattern?

Group the step observations by intervals 

```{r}

  DFGroupInt<- group_by(mydata3, interval)
  DFResultInt <- summarise(DFGroupInt,Mean = mean(steps), SUM = as.numeric(sum(steps)), MAX = as.numeric(max(steps)))

  stepMax <- max(DFResultInt$Mean)
  stepNA <- nrow(x)

  stepPoint <- subset(DFResultInt, Mean == stepMax)

```

The line graph of average steps per interval

```{r, echo= FALSE}

  par(mar = rep(2, 4))

  plot(x=DFResultInt$interval, y=DFResultInt$Mean, type = "l", xlab = " ", ylab = "Average Steps per Interval")

  points(x=stepPoint$interval, y=stepPoint$Mean, col = "red", type ="p")
  text(x=stepPoint$interval + 5, y=stepPoint$Mean,"Highest number of steps for the day")
```


##Imputing missing values:

As the next step, the interval averages for observations with valid step data are used to populate the observations without data. The data set is re-combined and then the analysis is repeated. 

```{r}
 

  mydataNA <- subset(mydata2,is.na(mydata2$steps))
  mydataNA <- select(mydataNA, -steps)
  
  DFStepFill <- select(DFResultInt,-SUM,-MAX)
  colnames(DFStepFill)[2] <- "steps"
  
  mydataNAFill <- left_join(mydataNA,DFStepFill)
  
  DFStepsComp <- rbind(mydata3,mydataNAFill)
  
  DFGroupDateComp <- group_by(DFStepsComp, date)
  DFResultDateComp <- summarise(DFGroupDateComp,Mean = mean(steps), SUM = as.numeric(sum(steps)))

  stepMeanComp <-mean(DFResultDateComp$SUM)
  stepMedianComp <-median(DFResultDateComp$SUM)
```

```{r, echo= FALSE} 
  hist(DFResultDateComp$SUM, xlab = "Number of Steps per Day", ylab = "Frequency", col = "red", main = "Histogram of Daily Step Total (completed data)")

  cat("Updated results after filling in the data:")
  cat("  The mean daily average = ", round(stepMeanComp))
  cat("  The median daily average = ", round(stepMedianComp))
  cat("  ")
  cat("The difference from prior calcualtions:")
  cat("  The new mean - prior mean =", stepMeanComp -stepMean)
  cat("  The new median - prior median =", stepMedianComp -stepMedian)

```

##Are there differences in activity patterns between weekdays and weekends?:

Next the filled in data set is grouped by weekday vs weekend and interval to produce a panel plot comparing the interval averages for weekend vs weekday.  
The data set was filled in using interval means; a future enhancement would be to fill in missing data using interval means plus weekday factor.

```{r}

  DFGroupIntW<- group_by(DFStepsComp, interval, wkdy)

  DFResultIntW <- summarise(DFGroupIntW,Mean = mean(steps), SUM = as.numeric(sum(steps)), MAX = as.numeric(max(steps)))

```
```{r, echo = FALSE}

#par(mfrow=c(1,2))
#plot(x=DFResultInt$interval, y=DFResultInt$Mean, type = "l", xlab = " ", #ylab = "Average Steps per Interval")

library(lattice)

xyplot(Mean~ interval| wkdy, type = 'b', panel = function(x, y) { llines(x=x,y=y) }, data = DFResultIntW, main = "Steps by Interval Weekend vs Weekday", xlab = "Intervals", ylab = "Mean Steps", layout=(c(1,2)))
```


